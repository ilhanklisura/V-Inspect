<!DOCTYPE html>
<html lang="bs">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prijava - VInspect</title>
    <link rel="stylesheet" href="../assets/css/style.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="auth-page">
      <div class="auth-card">
        <div class="auth-header">
          <h1 class="auth-title">VInspect</h1>
          <p class="auth-subtitle">Prijavite se na vaš račun</p>
        </div>

        <form id="loginForm">
          <div class="form-group">
            <label for="email" class="form-label">Email</label>
            <input type="email" id="email" class="form-control" required />
          </div>

          <div class="form-group">
            <label for="password" class="form-label">Lozinka</label>
            <input
              type="password"
              id="password"
              class="form-control"
              required
            />
          </div>

          <div
            id="loginError"
            class="error-message mb-3"
            style="display: none"
          ></div>

          <button type="submit" class="btn btn-primary w-100">Prijava</button>
        </form>

        <div class="auth-footer">
          <p>
            Nemate račun?
            <a href="register.html" class="auth-link">Registrujte se</a>
          </p>
          <p><a href="../index.html" class="auth-link">Nazad na početnu</a></p>
        </div>
      </div>
    </div>

    <script src="../assets/js/api.js"></script>
    <script src="../assets/js/auth.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // If user is already logged in, redirect to dashboard
        if (api.isAuthenticated()) {
          const user = auth.loadUserFromToken();
          if (user) {
            auth.redirectToDashboard();
          }
        }

        const loginForm = document.getElementById("loginForm");
        const errorMsg = document.getElementById("loginError");

        loginForm.addEventListener("submit", async function (e) {
          e.preventDefault();

          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;

          // Clear previous error
          errorMsg.style.display = "none";

          try {
            const result = await auth.login(email, password);

            if (result.success) {
              // Redirect handled by auth.login
            } else {
              errorMsg.textContent = result.error;
              errorMsg.style.display = "block";
            }
          } catch (error) {
            errorMsg.textContent = error.message || "Greška prilikom prijave";
            errorMsg.style.display = "block";
          }
        });
      });
    </script>
  </body>
</html>
